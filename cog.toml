# =============================================================================
# Cocogitto Configuration
# =============================================================================
#
# Cocogitto (cog) enforces Conventional Commits and automates versioning.
# Full documentation: https://docs.cocogitto.io/
#
# Quick reference:
#   cog check         - Verify all commits follow conventional format
#   cog bump --auto   - Bump version based on commit types (feat=minor, fix=patch)
#   cog bump --major  - Force a major version bump
#   cog changelog     - Generate/update CHANGELOG.md
#   cog install-hook  - Install git hooks defined in this file
#
# =============================================================================

# -----------------------------------------------------------------------------
# Commit Validation Settings
# -----------------------------------------------------------------------------

# Skip merge commits when validating commit messages.
# Merge commits are auto-generated by git and don't follow conventional format.
ignore_merge_commits = true

# Only check commits since the latest version tag.
# Avoids failing on legacy commits with non-conventional messages.
from_latest_tag = true

# Only allow version bumps from these branches.
# Prevents accidental releases from feature branches.
branch_whitelist = ["main"]

# -----------------------------------------------------------------------------
# Version Tag Settings
# -----------------------------------------------------------------------------

# Prefix for version tags (e.g., "v1.2.3" instead of "1.2.3").
# This is the most common convention and works well with GitHub releases.
tag_prefix = "v"

# Generate changelog
disable_changelog = false

# -----------------------------------------------------------------------------
# Bump Hooks
# -----------------------------------------------------------------------------
#
# Hooks run during `cog bump`. Available variables:
#   {{latest}}  - Current version before bump (e.g., "1.2.3")
#   {{version}} - New version after bump (e.g., "1.3.0")
#
# Hook execution order:
#   1. pre_bump_hooks run
#   2. CHANGELOG.md is generated/updated
#   3. Version tag is created
#   4. post_bump_hooks run
#
# If any hook fails (non-zero exit), the bump is aborted.
# -----------------------------------------------------------------------------

pre_bump_hooks = [
    # Update VERSION file
    "echo {{version}} > VERSION",
    "echo 'bumping from {{latest|0.0.0}} to {{version}}'",
    # Rebuild with new version
    "just build",
    # Stage VERSION and built script (gh-coda must be in repo for gh ext install)
    "git add VERSION git-pm",
]

# Post-bump hooks run after the tag is created
post_bump_hooks = [
    "git push",
    "git push origin v{{version}}",
]

[changelog]
path = "CHANGELOG.md"
template = "remote"
remote = "github.com"
repository = "git-pm"
owner = "claylo"

# Map commit types to changelog sections
[commit_types]
feat = { changelog_title = "Features" }
fix = { changelog_title = "Bug Fixes" }
docs = { changelog_title = "Documentation" }
style = { changelog_title = "Style" }
refactor = { changelog_title = "Refactoring" }
perf = { changelog_title = "Performance" }
# test = "Tests"
build = { changelog_title = "Build" }
ci = { omit_from_changelog = true }
# chore = "Chores"
# Maintenance tasks (deps, tooling) - don't clutter the changelog
chore = { omit_from_changelog = true }
# Test changes rarely interest end users
test = { omit_from_changelog = true }
